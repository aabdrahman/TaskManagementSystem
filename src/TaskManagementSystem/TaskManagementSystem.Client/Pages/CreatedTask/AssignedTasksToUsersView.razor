

<div class="p-3 mb-2 bg-info-subtle text-info-emphasis">
    Assigned Sub Tasks To Users
</div>

<div class="btn btn-primary my-2" @onclick="OnHandleAddNewUserTask">
    Assign New Task To User
</div>

<table class="table table-striped table-hover">
    <thead>
        <tr class="border-top" style="border-top-width:50px;">
            <th>Title</th>
            <th>Expected Delivery Date</th>
            <th>Assigned User</th>
            <th>Status</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach(var assignedTask in _tasksAssignedToUser)
        {
            <tr style="cursor:pointer;">
                <td>@assignedTask.Title</td>
                <td>@assignedTask.ProposedCompletionDate.ToString("dd MMM yyyy")</td>
                <td>@assignedTask.AssignedUser</td>
                <td>
                    @if (assignedTask.CompletionDate.HasValue)
                    {
                        <span class="badge rounded-pill text-bg-success">Completed</span>
                    }
                    else if (assignedTask.CancelReason is not null)
                    {
                        <span class="badge rounded-pill text-bg-secondary">Cancelled</span>
                    }
                    else if (assignedTask.ProposedCompletionDate < DateTime.UtcNow.Date)
                    {
                        <span class="badge rounded-pill text-bg-danger">Overdue</span>
                    }
                    else if (assignedTask.ProposedCompletionDate == DateTime.UtcNow.Date)
                    {
                        <span class="badge rounded-pill text-bg-warning">Due Today</span>
                    }
                    else
                    {
                        <span class="badge rounded-pill text-bg-info">Pending</span>
                    }
                </td>
                <td class="d-flex justify-content-between align-content-center">
                    @if(!assignedTask.CompletionDate.HasValue && string.IsNullOrEmpty(assignedTask.CancelReason))
                    {
                        <button class="btn btn-outline-primary" type="button" @onclick:stopPropagation="true" @onclick="(() => OnHandleEditUserTask(assignedTask))">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
                                <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.5.5 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11z" />
                            </svg>
                        </button>
                        <button class="btn btn-danger" type="button" @onclick:stopPropagation="true" @onclick="(() => OnHandleDeleteUserTask(assignedTask))">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
                                <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5m-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06m6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528M8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5" />
                            </svg>
                        </button>
                        <button class="btn btn-info" type="button" @onclick:stopPropagation="true" @onclick="(() => OnHandleReassignUserTask(assignedTask))">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill-gear" viewBox="0 0 16 16">
                                <path d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0m-9 8c0 1 1 1 1 1h5.256A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1 1.544-3.393Q8.844 9.002 8 9c-5 0-6 3-6 4m9.886-3.54c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382zM14 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0" />
                            </svg>
                        </button>
                    }
                    <button class="btn btn-primary" type="button" @onclick:stopPropagation="true" @onclick="(() => OnHandleViewDeatils(assignedTask))">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-binoculars-fill" viewBox="0 0 16 16">
                            <path d="M4.5 1A1.5 1.5 0 0 0 3 2.5V3h4v-.5A1.5 1.5 0 0 0 5.5 1zM7 4v1h2V4h4v.882a.5.5 0 0 0 .276.447l.895.447A1.5 1.5 0 0 1 15 7.118V13H9v-1.5a.5.5 0 0 1 .146-.354l.854-.853V9.5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v.793l.854.853A.5.5 0 0 1 7 11.5V13H1V7.118a1.5 1.5 0 0 1 .83-1.342l.894-.447A.5.5 0 0 0 3 4.882V4zM1 14v.5A1.5 1.5 0 0 0 2.5 16h3A1.5 1.5 0 0 0 7 14.5V14zm8 0v.5a1.5 1.5 0 0 0 1.5 1.5h3a1.5 1.5 0 0 0 1.5-1.5V14zm4-11H9v-.5A1.5 1.5 0 0 1 10.5 1h1A1.5 1.5 0 0 1 13 2.5z" />
                        </svg>
                    </button>
                </td>
            </tr>
        }
    </tbody>
</table>


@code {
    private IEnumerable<Shared.DataTransferObjects.TaskUser.TaskUserDto> _tasksAssignedToUser;

    [Parameter, EditorRequired]
    public IEnumerable<Shared.DataTransferObjects.TaskUser.TaskUserDto> TasksAssignedToUser { get; set; }

    [Parameter, EditorRequired]
    public EventCallback<Shared.DataTransferObjects.TaskUser.TaskUserDto> HandleShowDetails { get; set; }

    [Parameter, EditorRequired]
    public EventCallback<Shared.DataTransferObjects.TaskUser.TaskUserDto> HandleDeleteUserTask { get; set; }

    [Parameter, EditorRequired]
    public EventCallback<Shared.DataTransferObjects.TaskUser.TaskUserDto> HandleEditUserTask { get; set; }

    [Parameter, EditorRequired]
    public EventCallback<Shared.DataTransferObjects.TaskUser.TaskUserDto> HandleReassignUserTask { get; set; }

    [Parameter, EditorRequired]
    public EventCallback HandleAddNewUserTask { get; set; }

    protected override void OnParametersSet()
    {
        _tasksAssignedToUser = TasksAssignedToUser;
    }

    private async Task OnHandleViewDeatils(Shared.DataTransferObjects.TaskUser.TaskUserDto selectedUserTask)
    {
        await HandleShowDetails.InvokeAsync(selectedUserTask);
    }

    private async Task OnHandleDeleteUserTask(Shared.DataTransferObjects.TaskUser.TaskUserDto selectedUserTask)
    {
        await HandleShowDetails.InvokeAsync(selectedUserTask);
    }

    private async Task OnHandleEditUserTask(Shared.DataTransferObjects.TaskUser.TaskUserDto selectedUserTask)
    {
        await HandleEditUserTask.InvokeAsync(selectedUserTask);
    }

    private async Task OnHandleReassignUserTask(Shared.DataTransferObjects.TaskUser.TaskUserDto selectedUserTask)
    {
        await HandleShowDetails.InvokeAsync(selectedUserTask);
    }

    private async Task OnHandleAddNewUserTask()
    {
        await HandleAddNewUserTask.InvokeAsync();
    }
}
